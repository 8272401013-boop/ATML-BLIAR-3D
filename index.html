<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Simulasi Hukum Newton III – Biliar 3D</title>

<style>
html,body{
  width:100%;height:100%;
  margin:0;overflow:hidden;
  font-family:Arial, Helvetica, sans-serif;
}
#renderCanvas{
  width:100%;height:100%;
}
#panel{
  position:absolute;
  top:10px;left:10px;
  z-index:10;
}
button{
  display:block;
  margin-bottom:8px;
  padding:10px 16px;
  border:none;
  border-radius:8px;
  background:#1d4ed8;
  color:white;
  font-size:14px;
  cursor:pointer;
}
#info{
  position:absolute;
  bottom:10px;left:10px;
  background:rgba(0,0,0,0.7);
  color:white;
  padding:10px;
  border-radius:8px;
  font-size:13px;
}
video{display:none}
</style>
</head>

<body>

<div id="panel">
  <button id="btnCamera">Aktifkan Kamera</button>
  <button id="btnReset">Reset Bola</button>
</div>

<div id="info">
<b>Petunjuk:</b><br>
Klik “Aktifkan Kamera” (aturan browser)<br>
Klik canvas untuk memukul bola<br>
Reset untuk mengulang eksperimen
</div>

<canvas id="renderCanvas"></canvas>
<video id="video" autoplay playsinline></video>

<!-- LIBRARY -->
<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://cdn.babylonjs.com/cannon.js"></script>
<script src="https://cdn.babylonjs.com/babylon.cannon.js"></script>

<script>
/* ===================================================
   INISIALISASI ENGINE & SCENE
=================================================== */
const canvas = document.getElementById("renderCanvas");
const engine = new BABYLON.Engine(canvas,true);
const scene = new BABYLON.Scene(engine);
scene.clearColor = new BABYLON.Color3(0.08,0.08,0.08);

scene.enablePhysics(
  new BABYLON.Vector3(0,-9.8,0),
  new BABYLON.CannonJSPlugin()
);

/* ===================================================
   KAMERA & CAHAYA
=================================================== */
const camera = new BABYLON.ArcRotateCamera(
  "camera",
  Math.PI/2,
  Math.PI/3,
  10,
  new BABYLON.Vector3(0,0,0),
  scene
);
camera.attachControl(canvas,true);

new BABYLON.HemisphericLight(
  "light",
  new BABYLON.Vector3(0,1,0),
  scene
);

/* ===================================================
   MEJA BILIAR
=================================================== */
const table = BABYLON.MeshBuilder.CreateBox("table",{
  width:7,
  depth:3.5,
  height:0.5
},scene);

table.position.y = -0.25;

const tableMat = new BABYLON.StandardMaterial("tableMat",scene);
tableMat.diffuseColor = new BABYLON.Color3(0.1,0.6,0.25);
table.material = tableMat;

table.physicsImpostor = new BABYLON.PhysicsImpostor(
  table,
  BABYLON.PhysicsImpostor.BoxImpostor,
  { mass:0, restitution:0.9 },
  scene
);

/* ===================================================
   FUNGSI BOLA
=================================================== */
function createBall(name,x,z,color){
  const ball = BABYLON.MeshBuilder.CreateSphere(
    name,{diameter:0.3},scene
  );
  ball.position.set(x,0.15,z);

  const mat = new BABYLON.StandardMaterial(name+"Mat",scene);
  mat.diffuseColor = color;
  ball.material = mat;

  ball.physicsImpostor = new BABYLON.PhysicsImpostor(
    ball,
    BABYLON.PhysicsImpostor.SphereImpostor,
    { mass:1, restitution:0.95 },
    scene
  );
  return ball;
}

const cueBall = createBall(
  "cue",-2,0,BABYLON.Color3.White()
);
const targetBall = createBall(
  "target",1.5,0,BABYLON.Color3.Yellow()
);

const cueStart = cueBall.position.clone();
const targetStart = targetBall.position.clone();

/* ===================================================
   RESET BOLA
=================================================== */
btnReset.onclick = () => {
  cueBall.physicsImpostor.setLinearVelocity(
    BABYLON.Vector3.Zero()
  );
  targetBall.physicsImpostor.setLinearVelocity(
    BABYLON.Vector3.Zero()
  );
  cueBall.position.copyFrom(cueStart);
  targetBall.position.copyFrom(targetStart);
};

/* ===================================================
   AKSI–REAKSI (HUKUM NEWTON III)
=================================================== */
canvas.addEventListener("pointerdown",()=>{
  const force = new BABYLON.Vector3(3,0,0);
  cueBall.physicsImpostor.applyImpulse(
    force,
    cueBall.getAbsolutePosition()
  );
});

/* ===================================================
   AKTIVASI KAMERA LAPTOP
=================================================== */
btnCamera.onclick = async () => {
  try{
    const stream = await navigator.mediaDevices.getUserMedia({
      video:true
    });
    document.getElementById("video").srcObject = stream;
    alert("Kamera laptop aktif ✔");
  }catch(e){
    alert("Kamera tidak dapat diakses");
  }
};

/* ===================================================
   RENDER LOOP
=================================================== */
engine.runRenderLoop(()=>{
  scene.render();
});

window.addEventListener("resize",()=>{
  engine.resize();
});
</script>

</body>
</html>
